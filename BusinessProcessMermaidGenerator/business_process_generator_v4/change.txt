# ОПИСАНИЕ ИЗМЕНЕНИЙ АРХИТЕКТУРЫ
# Business Process Generator v3.0 → v4.0
# =============================================

## ОБЩАЯ ИНФОРМАЦИЯ
- Дата изменений: 2024
- Версия: 3.0 → 4.0
- Основное изменение: Замена Tkinter на PyQt6 + добавление Markdown редактора
- Статус: Полная переработка архитектуры

## СТРУКТУРНЫЕ ИЗМЕНЕНИЯ

### БЫЛО (v3.0):
business_process_generator/
├── main.py # Точка входа (только GUI)
├── gui_interface.py # Tkinter GUI
├── config_manager.py # Менеджер конфигурации
├── data_loader.py # Загрузка данных
├── analysis.py # Анализ процессов
├── models.py # Модели данных
├── utils.py # Утилиты
├── exporters/ # Модули экспорта
│ ├── mermaid_exporter.py
│ ├── html_exporter.py
│ ├── interactive_exporter.py
│ └── svg_exporter.py
└── config.py # Конфигурация

text

### СТАЛО (v4.0):
business_process_generator_v4/
├── 🏗️ core/ # ЯДРО СИСТЕМЫ
│ ├── init.py
│ ├── data_loader.py # ОБНОВЛЕН: возвращает кортеж (DataFrame, error)
│ ├── analysis.py # БЕЗ ИЗМЕНЕНИЙ (логика анализа)
│ └── models.py # БЕЗ ИЗМЕНЕНИЙ (data classes)
├── 🎨 gui/ # НОВЫЙ СОВРЕМЕННЫЙ GUI
│ ├── init.py
│ ├── main_window.py # НОВЫЙ: главное окно PyQt6
│ ├── setup_panel.py # НОВЫЙ: панель настройки генерации
│ ├── editor_panel.py # НОВЫЙ: редактор Markdown
│ ├── preview_panel.py # НОВЫЙ: предпросмотр Mermaid
│ └── components/ # НОВЫЙ: переиспользуемые компоненты
│ ├── init.py
│ └── theme_manager.py # НОВЫЙ: менеджер тем
├── 📤 exporters/ # МОДУЛИ ЭКСПОРТА (ОБНОВЛЕНЫ)
│ ├── init.py
│ ├── mermaid_exporter.py # ОБНОВЛЕН: добавлена generate_mermaid_full_markdown()
│ ├── html_exporter.py # БЕЗ ИЗМЕНЕНИЙ
│ ├── interactive_exporter.py # БЕЗ ИЗМЕНЕНИЙ
│ └── svg_exporter.py # БЕЗ ИЗМЕНЕНИЙ
├── 🔧 utils/ # УТИЛИТЫ (РЕОРГАНИЗОВАНЫ)
│ ├── init.py
│ ├── text_processing.py # ПЕРЕИМЕНОВАН: был utils.py
│ └── mermaid_renderer.py # НОВЫЙ: рендерер для live preview
├── ⚙️ config/ # КОНФИГУРАЦИЯ (РЕОРГАНИЗОВАНА)
│ ├── init.py
│ └── constants.py # ПЕРЕИМЕНОВАН: был config.py
├── 📄 main.py # ОБНОВЛЕН: точка входа PyQt6
├── 📄 requirements.txt # ОБНОВЛЕН: добавлены PyQt6 зависимости
└── 📄 app_config.json # НОВЫЙ: конфигурация приложения

text

## ЛОГИЧЕСКИЕ ИЗМЕНЕНИЯ

### 1. ИЗМЕНЕНИЕ АРХИТЕКТУРЫ GUI
БЫЛО:

Однооконное приложение Tkinter

Отдельные диалоги для настроек

Результат открывается в браузере

Нет встроенного редактора

СТАЛО:

Многопанельное окно PyQt6 с табами

Встроенный Markdown редактор с подсветкой

Live preview Mermaid диаграмм

Единая среда (IDE-подобная)

text

### 2. ИЗМЕНЕНИЕ ПОТОКА РАБОТЫ
БЫЛО:

Выбор файла Excel в GUI

Настройка параметров

Генерация → сохранение файла

Авто-открытие в браузере

Ручное редактирование во внешнем редакторе

СТАЛО:

Выбор файла Excel в GUI

Настройка параметров

Генерация → автоматическая загрузка в редактор

Live preview с рендерингом Mermaid

Встроенное редактирование и сохранение

text

### 3. ИЗМЕНЕНИЕ МОДЕЛИ ДАННЫХ
БЫЛО:

Конфигурация в bp_config.json

Настройки через config_manager.py

QSettings не используется

СТАЛО:

Конфигурация в QSettings (окна/геометрия)

Настройки приложения в app_config.json

Сохранение состояния сессии

text

### 4. ИЗМЕНЕНИЕ ОБРАБОТКИ ОШИБОК
БЫЛО:

Функции возвращают None при ошибке

Вывод ошибок в консоль

Прерывание выполнения

СТАЛО:

Функции возвращают кортежи (результат, ошибка)

Визуальное отображение ошибок в GUI

Продолжение работы приложения при ошибках

text

### 5. ИЗМЕНЕНИЕ СИСТЕМЫ ЭКСПОРТА
БЫЛО:

Экспорт только в файлы

Нет возможности получить контент без сохранения

СТАЛО:

Два режима: экспорт в файл и генерация контента

Новая функция generate_mermaid_full_markdown()

Поддержка live preview без создания файлов

text

## ТЕХНИЧЕСКИЕ ИЗМЕНЕНИЯ

### 1. МНОГОПОТОЧНОСТЬ
БЫЛО:

Синхронная генерация в основном потоке

Блокировка UI во время генерации

СТАЛО:

Асинхронная генерация в QThread

Неблокирующий UI

Сигналы для обновления интерфейса

text

### 2. РЕНДЕРИНГ MERMAID
БЫЛО:

Рендеринг только в браузере

Нет встроенного preview

СТАЛО:

Встроенный рендерер Mermaid на QWebEngineView

Live preview при редактировании

Поддержка темного/светлого режима

text

### 3. СИСТЕМА ТЕМ
БЫЛО:

Стандартный вид Tkinter

Нет кастомизации

СТАЛО:

Кастомные темы (темная/светлая)

Менеджер тем с централизованным управлением

Консистентный внешний вид

text

### 4. РЕДАКТОР MARKDOWN
БЫЛО:

Отсутствует встроенный редактор

Редактирование во внешних программах

СТАЛО:

Встроенный редактор с подсветкой синтаксиса

Подсветка Mermaid блоков

Настройки шрифтов и размера

Автосохранение

text

## ИНТЕРФЕЙСНЫЕ ИЗМЕНЕНИЯ

### 1. ГЛАВНОЕ ОКНО
БЫЛО (Tkinter):

Одно окно с полями ввода

Кнопки управления внизу

Минималистичный дизайн

СТАЛО (PyQt6):

Разделенное окно с сплиттерами

Вкладки для разных функций

Современный дизайн с иконками

Статус бар и панели инструментов

text

### 2. НАВИГАЦИЯ
БЫЛО:

Линейный workflow

Последовательные шаги

СТАЛО:

Параллельный доступ ко всем функциям

Мгновенное переключение между вкладками

Одновременный просмотр и редактирование

text

### 3. ОБРАТНАЯ СВЯЗЬ
БЫЛО:

Текстовые сообщения в консоли

Базовые диалоги ошибок

СТАЛО:

Визуальные индикаторы прогресса

Подробные сообщения об ошибках

Статус бар с информацией

Tooltips и подсказки

text

## ФУНКЦИОНАЛЬНЫЕ ИЗМЕНЕНИЯ

### 1. НОВЫЕ ВОЗМОЖНОСТИ
- ✅ Live preview Mermaid диаграмм
- ✅ Встроенный редактор Markdown с подсветкой
- ✅ Многопоточная генерация
- ✅ Темная/светлая темы
- ✅ Автосохранение проектов
- ✅ Предпросмотр в реальном времени
- ✅ Подсветка синтаксиса Mermaid
- ✅ Настройки шрифтов редактора

### 2. УЛУЧШЕННЫЕ ВОЗМОЖНОСТИ
- ✅ Более информативные сообщения об ошибках
- ✅ Неблокирующий интерфейс
- ✅ Улучшенная навигация
- ✅ Современный дизайн
- ✅ Лучшая производительность

### 3. СОХРАНЕННЫЕ ВОЗМОЖНОСТИ
- ✅ Все форматы экспорта (Mermaid, HTML, SVG, Interactive)
- ✅ Анализ бизнес-процессов
- ✅ Группировка операций
- ✅ Определение критических точек
- ✅ Поддержка Excel файлов
- ✅ Автоматическое определение листов

## ЗАВИСИМОСТИ

### БЫЛО (requirements.txt):
pandas>=1.5.0
openpyxl>=3.0.0

text

### СТАЛО (requirements.txt):
GUI Framework
PyQt6>=6.6.0
PyQt6-WebEngine>=6.6.0
PyQt6-Qt6>=6.6.0

Data Processing
pandas>=2.0.0
openpyxl>=3.1.0

Markdown & Visualization
markdown>=3.5.0

Development
black>=23.0.0
flake8>=6.0.0

text

## ИЗВЕСТНЫЕ ОГРАНИЧЕНИЯ v4.0

### 1. ТРЕБОВАНИЯ К СИСТЕМЕ
- Требуется PyQt6 (больший размер дистрибутива)
- Увеличено потребление памяти
- Более высокие требования к hardware

### 2. СОВМЕСТИМОСТЬ
- Несовместимо с Python 2.x
- Требуется Python 3.8+
- Изменения в API модулей

### 3. МИГРАЦИЯ
- Существующие конфиги несовместимы
- Требуется переустановка зависимостей
- Изменения в workflow пользователя

## МИГРАЦИОННЫЕ ПУНКТЫ

### ДЛЯ ПОЛЬЗОВАТЕЛЕЙ:
1. Установить новые зависимости (PyQt6)
2. Ознакомиться с новым интерфейсом
3. Перенастроить параметры приложения

### ДЛЯ РАЗРАБОТЧИКОВ:
1. Обновить импорты модулей
2. Адаптировать к новому API data_loader
3. Использовать новые сигналы PyQt6

## ТЕСТИРОВАНИЕ ИЗМЕНЕНИЙ

### КРИТИЧЕСКИЕ ТОЧКИ:
1. Загрузка Excel файлов → data_loader.py
2. Генерация Mermaid → mermaid_exporter.py  
3. Многопоточность → setup_panel.py
4. Рендеринг preview → mermaid_renderer.py
5. Настройки тем → theme_manager.py

### ЧАСТЫЕ ОШИБКИ:
1. Отсутствие PyQt6
2. Проблемы с импортом модулей
3. Ошибки в многопоточности
4. Проблемы рендеринга Mermaid

## ЗАКЛЮЧЕНИЕ

Переход с v3.0 на v4.0 представляет собой полную переработку архитектуры 
с сохранением всей бизнес-логики, но с кардинальным улучшением 
пользовательского опыта и добавлением современных возможностей 
редактора типа IDE.

Основной фокус сместился с утилитарной генерации файлов 
на создание комплексной среды для работы с бизнес-процессами, 
сочетающей мощь анализа с удобством современного редактора.