<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диаграмма бизнес-процесса</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .diagram {
            flex: 1;
            background: white;
        }
        .statistics {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .stat-item {
            margin: 5px 0;
            font-size: 14px;
        }
        .critical-list {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }
        .controls {
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .node-info {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
        h1, h2, h3 {
            color: #333;
            margin-top: 0;
        }
        #network {
            width: 100%;
            height: 100%;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Бизнес-процесс</h1>
            
            <div class="statistics">
                <h3>Статистика</h3>
                <div class="stat-item">Операций: <strong id="stats-operations">0</strong></div>
                <div class="stat-item">Внешние входы: <strong id="stats-inputs">0</strong></div>
                <div class="stat-item">Конечные выходы: <strong id="stats-outputs">0</strong></div>
                <div class="stat-item">Точек слияния: <strong id="stats-merge">0</strong></div>
                <div class="stat-item">Точек разветвления: <strong id="stats-split">0</strong></div>
                <div class="stat-item">Критических операций: <strong id="stats-critical">0</strong></div>
            </div>

            <div class="critical-list" id="critical-section">
                <h3>Критические операции</h3>
                <div id="critical-list"></div>
            </div>

            <div class="controls">
                <h3>Управление</h3>
                <button onclick="fitToScreen()">Вписать в экран</button>
                <button onclick="resetZoom()">Сбросить масштаб</button>
                <button onclick="togglePhysics()">Физика: Вкл</button>
            </div>

            <div class="node-info">
                <h3>Информация</h3>
                <div id="node-info">Выберите элемент на диаграмме</div>
            </div>
        </div>

        <div class="diagram">
            <div id="network"></div>
        </div>
    </div>

    <script>
        // Данные диаграммы
        const diagramData = {
  "nodes": [
    {
      "id": "Данные_о_спросе",
      "label": "Данные о спросе",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Жалоба_клиента",
      "label": "Жалоба клиента",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Запрос_клиента",
      "label": "Запрос клиента",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Запрос_на_возврат",
      "label": "Запрос на возврат",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Исторические_продажи",
      "label": "Исторические продажи",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Сезонность",
      "label": "Сезонность",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Товар_продан",
      "label": "Товар продан",
      "type": "external",
      "shape": "ellipse",
      "color": {
        "background": "#fff9c4",
        "border": "#f57f17"
      },
      "font": {
        "size": 14
      }
    },
    {
      "id": "Возврат_обработан",
      "label": "Возврат обработан",
      "type": "final",
      "shape": "ellipse",
      "color": {
        "background": "#ffcdd2",
        "border": "#c62828"
      },
      "font": {
        "size": 14,
        "color": "#ffffff"
      }
    },
    {
      "id": "Жалоба_решена",
      "label": "Жалоба решена",
      "type": "final",
      "shape": "ellipse",
      "color": {
        "background": "#ffcdd2",
        "border": "#c62828"
      },
      "font": {
        "size": 14,
        "color": "#ffffff"
      }
    },
    {
      "id": "Заказ_закрыт",
      "label": "Заказ закрыт",
      "type": "final",
      "shape": "ellipse",
      "color": {
        "background": "#ffcdd2",
        "border": "#c62828"
      },
      "font": {
        "size": 14,
        "color": "#ffffff"
      }
    },
    {
      "id": "План_закупок",
      "label": "План закупок",
      "type": "final",
      "shape": "ellipse",
      "color": {
        "background": "#ffcdd2",
        "border": "#c62828"
      },
      "font": {
        "size": 14,
        "color": "#ffffff"
      }
    },
    {
      "id": "Прием_заказа",
      "label": "Прием заказа",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Прием заказа</b><br>Проверка доступности товара и подтверждение заказа",
      "group": "Продажи",
      "owner": "Менеджер",
      "detailed": "Проверка доступности товара и подтверждение заказа"
    },
    {
      "id": "Проверка_наличия",
      "label": "Проверка наличия",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Проверка наличия</b><br>Проверка наличия товара на складе",
      "group": "Склад",
      "owner": "Кладовщик",
      "detailed": "Проверка наличия товара на складе"
    },
    {
      "id": "Резервирование_товара",
      "label": "Резервирование товара",
      "type": "split",
      "shape": "box",
      "color": {
        "background": "#ba68c8",
        "border": "#6a1b9a",
        "font": {
          "color": "#ffffff"
        }
      },
      "font": {
        "size": 14
      },
      "title": "<b>Резервирование товара</b><br>Резервирование товара для заказа",
      "group": "Склад",
      "owner": "Кладовщик",
      "detailed": "Резервирование товара для заказа"
    },
    {
      "id": "Формирование_счета",
      "label": "Формирование счета",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Формирование счета</b><br>Создание счета с учетом доставки и налогов",
      "group": "Финансы",
      "owner": "Бухгалтер",
      "detailed": "Создание счета с учетом доставки и налогов"
    },
    {
      "id": "Отправка_счета",
      "label": "Отправка счета",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Отправка счета</b><br>Отправка счета клиенту по email",
      "group": "Продажи",
      "owner": "Менеджер",
      "detailed": "Отправка счета клиенту по email"
    },
    {
      "id": "Ожидание_оплаты",
      "label": "Ожидание оплаты",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Ожидание оплаты</b><br>Ожидание поступления оплаты от клиента",
      "group": "Финансы",
      "owner": "Бухгалтер",
      "detailed": "Ожидание поступления оплаты от клиента"
    },
    {
      "id": "Подготовка_к_отгрузке",
      "label": "Подготовка к отгрузке",
      "type": "merge",
      "shape": "box",
      "color": {
        "background": "#ffb74d",
        "border": "#ef6c00"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Подготовка к отгрузке</b><br>Упаковка товара и подготовка к отправке",
      "group": "Склад",
      "owner": "Кладовщик",
      "detailed": "Упаковка товара и подготовка к отправке"
    },
    {
      "id": "Оформление_доставки",
      "label": "Оформление доставки",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Оформление доставки</b><br>Оформление доставки через курьерскую службу",
      "group": "Логистика",
      "owner": "Логист",
      "detailed": "Оформление доставки через курьерскую службу"
    },
    {
      "id": "Отслеживание_доставки",
      "label": "Отслеживание доставки",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Отслеживание доставки</b><br>Мониторинг статуса доставки",
      "group": "Логистика",
      "owner": "Логист",
      "detailed": "Мониторинг статуса доставки"
    },
    {
      "id": "Подтверждение_получения",
      "label": "Подтверждение получения",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Подтверждение получения</b><br>Подтверждение получения от клиента",
      "group": "Продажи",
      "owner": "Менеджер",
      "detailed": "Подтверждение получения от клиента"
    },
    {
      "id": "Закрытие_заказа",
      "label": "Закрытие заказа",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Закрытие заказа</b><br>Окончательное закрытие заказа в системе",
      "group": "Продажи",
      "owner": "Менеджер",
      "detailed": "Окончательное закрытие заказа в системе"
    },
    {
      "id": "Обработка_возвратов",
      "label": "Обработка возвратов",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Обработка возвратов</b><br>Обработка запросов на возврат товара",
      "group": "Сервис",
      "owner": "Менеджер",
      "detailed": "Обработка запросов на возврат товара"
    },
    {
      "id": "Прием_жалоб",
      "label": "Прием жалоб",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Прием жалоб</b><br>Регистрация и классификация жалоб",
      "group": "Сервис",
      "owner": "Менеджер",
      "detailed": "Регистрация и классификация жалоб"
    },
    {
      "id": "Расследование_жалобы",
      "label": "Расследование жалобы",
      "type": "split",
      "shape": "box",
      "color": {
        "background": "#ba68c8",
        "border": "#6a1b9a",
        "font": {
          "color": "#ffffff"
        }
      },
      "font": {
        "size": 14
      },
      "title": "<b>Расследование жалобы</b><br>Анализ причин возникновения жалобы",
      "group": "Сервис",
      "owner": "Менеджер",
      "detailed": "Анализ причин возникновения жалобы"
    },
    {
      "id": "Решение_по_жалобе",
      "label": "Решение по жалобе",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Решение по жалобе</b><br>Принятие решения по устранению жалобы",
      "group": "Сервис",
      "owner": "Менеджер",
      "detailed": "Принятие решения по устранению жалобы"
    },
    {
      "id": "Учет_качества",
      "label": "Учет качества",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Учет качества</b><br>Сбор статистики по качеству товаров",
      "group": "Качество",
      "owner": "Менеджер качества",
      "detailed": "Сбор статистики по качеству товаров"
    },
    {
      "id": "Анализ_качества",
      "label": "Анализ качества",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Анализ качества</b><br>Анализ тенденций качества продукции",
      "group": "Качество",
      "owner": "Менеджер качества",
      "detailed": "Анализ тенденций качества продукции"
    },
    {
      "id": "Корректирующие_действия",
      "label": "Корректирующие действия",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Корректирующие действия</b><br>Разработка плана улучшения качества",
      "group": "Производство",
      "owner": "Директор",
      "detailed": "Разработка плана улучшения качества"
    },
    {
      "id": "Закупка_материалов",
      "label": "Закупка материалов",
      "type": "merge",
      "shape": "box",
      "color": {
        "background": "#ffb74d",
        "border": "#ef6c00"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Закупка материалов</b><br>Закупка материалов для производства",
      "group": "Закупки",
      "owner": "Закупщик",
      "detailed": "Закупка материалов для производства"
    },
    {
      "id": "Производство",
      "label": "Производство",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Производство</b><br>Производство товаров согласно плану",
      "group": "Производство",
      "owner": "Производственник",
      "detailed": "Производство товаров согласно плану"
    },
    {
      "id": "Контроль_качества",
      "label": "Контроль качества",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Контроль качества</b><br>Проверка качества готовой продукции",
      "group": "Качество",
      "owner": "Контролер",
      "detailed": "Проверка качества готовой продукции"
    },
    {
      "id": "Поступление_на_склад",
      "label": "Поступление на склад",
      "type": "normal",
      "shape": "box",
      "color": {
        "background": "#90caf9",
        "border": "#1565c0"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Поступление на склад</b><br>Размещение товара на складе",
      "group": "Склад",
      "owner": "Кладовщик",
      "detailed": "Размещение товара на складе"
    },
    {
      "id": "Учет_остатков",
      "label": "Учет остатков",
      "type": "merge",
      "shape": "box",
      "color": {
        "background": "#ffb74d",
        "border": "#ef6c00"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Учет остатков</b><br>Обновление данных об остатках",
      "group": "Склад",
      "owner": "Кладовщик",
      "detailed": "Обновление данных об остатках"
    },
    {
      "id": "Прогнозирование_спроса",
      "label": "Прогнозирование спроса",
      "type": "merge",
      "shape": "box",
      "color": {
        "background": "#ffb74d",
        "border": "#ef6c00"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Прогнозирование спроса</b><br>Прогнозирование будущего спроса",
      "group": "Аналитика",
      "owner": "Аналитик",
      "detailed": "Прогнозирование будущего спроса"
    },
    {
      "id": "Планирование_закупок",
      "label": "Планирование закупок",
      "type": "merge",
      "shape": "box",
      "color": {
        "background": "#ffb74d",
        "border": "#ef6c00"
      },
      "font": {
        "size": 14
      },
      "title": "<b>Планирование закупок</b><br>Планирование объемов закупок",
      "group": "Закупки",
      "owner": "Закупщик",
      "detailed": "Планирование объемов закупок"
    }
  ],
  "edges": [
    {
      "from": "Прием_заказа",
      "to": "Проверка_наличия",
      "label": "Подтвержденный заказ",
      "arrows": "to"
    },
    {
      "from": "Запрос_клиента",
      "to": "Прием_заказа",
      "label": "Запрос клиента",
      "arrows": "to"
    },
    {
      "from": "Проверка_наличия",
      "to": "Резервирование_товара",
      "label": "Информация о наличии",
      "arrows": "to"
    },
    {
      "from": "Резервирование_товара",
      "to": "Формирование_счета",
      "label": "Зарезервированный товар",
      "arrows": "to"
    },
    {
      "from": "Резервирование_товара",
      "to": "Подготовка_к_отгрузке",
      "label": "Зарезервированный товар",
      "arrows": "to"
    },
    {
      "from": "Формирование_счета",
      "to": "Отправка_счета",
      "label": "Счет на оплату",
      "arrows": "to"
    },
    {
      "from": "Отправка_счета",
      "to": "Ожидание_оплаты",
      "label": "Счет отправлен",
      "arrows": "to"
    },
    {
      "from": "Ожидание_оплаты",
      "to": "Подготовка_к_отгрузке",
      "label": "Оплата получена",
      "arrows": "to"
    },
    {
      "from": "Подготовка_к_отгрузке",
      "to": "Оформление_доставки",
      "label": "Товар упакован",
      "arrows": "to"
    },
    {
      "from": "Оформление_доставки",
      "to": "Отслеживание_доставки",
      "label": "Товар передан в доставку",
      "arrows": "to"
    },
    {
      "from": "Отслеживание_доставки",
      "to": "Подтверждение_получения",
      "label": "Товар доставлен",
      "arrows": "to"
    },
    {
      "from": "Подтверждение_получения",
      "to": "Закрытие_заказа",
      "label": "Получение подтверждено",
      "arrows": "to"
    },
    {
      "from": "Закрытие_заказа",
      "to": "Заказ_закрыт",
      "label": "Заказ закрыт",
      "arrows": "to"
    },
    {
      "from": "Обработка_возвратов",
      "to": "Возврат_обработан",
      "label": "Возврат обработан",
      "arrows": "to"
    },
    {
      "from": "Запрос_на_возврат",
      "to": "Обработка_возвратов",
      "label": "Запрос на возврат",
      "arrows": "to"
    },
    {
      "from": "Прием_жалоб",
      "to": "Расследование_жалобы",
      "label": "Жалоба зарегистрирована",
      "arrows": "to"
    },
    {
      "from": "Жалоба_клиента",
      "to": "Прием_жалоб",
      "label": "Жалоба клиента",
      "arrows": "to"
    },
    {
      "from": "Расследование_жалобы",
      "to": "Решение_по_жалобе",
      "label": "Причина жалобы",
      "arrows": "to"
    },
    {
      "from": "Расследование_жалобы",
      "to": "Учет_качества",
      "label": "Причина жалобы",
      "arrows": "to"
    },
    {
      "from": "Решение_по_жалобе",
      "to": "Жалоба_решена",
      "label": "Жалоба решена",
      "arrows": "to"
    },
    {
      "from": "Учет_качества",
      "to": "Анализ_качества",
      "label": "Данные о качестве",
      "arrows": "to"
    },
    {
      "from": "Анализ_качества",
      "to": "Корректирующие_действия",
      "label": "Отчет о качестве",
      "arrows": "to"
    },
    {
      "from": "Корректирующие_действия",
      "to": "Закупка_материалов",
      "label": "План улучшений",
      "arrows": "to"
    },
    {
      "from": "Закупка_материалов",
      "to": "Производство",
      "label": "Материалы закуплены",
      "arrows": "to"
    },
    {
      "from": "Данные_о_спросе",
      "to": "Закупка_материалов",
      "label": "Данные о спросе",
      "arrows": "to"
    },
    {
      "from": "Производство",
      "to": "Контроль_качества",
      "label": "Готовая продукция",
      "arrows": "to"
    },
    {
      "from": "Контроль_качества",
      "to": "Поступление_на_склад",
      "label": "Товар проверен",
      "arrows": "to"
    },
    {
      "from": "Поступление_на_склад",
      "to": "Учет_остатков",
      "label": "Товар на складе",
      "arrows": "to"
    },
    {
      "from": "Учет_остатков",
      "to": "Планирование_закупок",
      "label": "Остатки на складе",
      "arrows": "to"
    },
    {
      "from": "Товар_продан",
      "to": "Учет_остатков",
      "label": "Товар продан",
      "arrows": "to"
    },
    {
      "from": "Прогнозирование_спроса",
      "to": "Планирование_закупок",
      "label": "Прогноз спроса",
      "arrows": "to"
    },
    {
      "from": "Исторические_продажи",
      "to": "Прогнозирование_спроса",
      "label": "Исторические продажи",
      "arrows": "to"
    },
    {
      "from": "Сезонность",
      "to": "Прогнозирование_спроса",
      "label": "Сезонность",
      "arrows": "to"
    },
    {
      "from": "Планирование_закупок",
      "to": "План_закупок",
      "label": "План закупок",
      "arrows": "to"
    }
  ],
  "statistics": {
    "operations_count": 25,
    "external_inputs": 7,
    "final_outputs": 4,
    "merge_points": 5,
    "split_points": 2,
    "critical_points": 0
  },
  "critical_operations": []
};

        // Инициализация сети
        let network = null;
        let physicsEnabled = true;

        function initNetwork() {
            const container = document.getElementById('network');
            const data = {
                nodes: new vis.DataSet(diagramData.nodes.map(node => ({
                    id: node.id,
                    label: node.label,
                    shape: node.shape,
                    color: node.color,
                    borderWidth: 2,
                    font: node.font,
                    shadow: true,
                    title: getNodeTooltip(node)
                }))),
                edges: new vis.DataSet(diagramData.edges.map(edge => ({
                    from: edge.from,
                    to: edge.to,
                    label: edge.label,
                    arrows: 'to',
                    font: { size: 12, align: 'middle' },
                    width: 2,
                    smooth: { enabled: true, type: 'dynamic' }
                })))
            };

            const options = {
                layout: {
                    improvedLayout: true,
                    hierarchical: {
                        enabled: false,
                        direction: 'LR',
                        sortMethod: 'directed'
                    }
                },
                physics: {
                    enabled: true,
                    stabilization: { iterations: 1000 },
                    barnesHut: {
                        gravitationalConstant: -80000,
                        springConstant: 0.04,
                        springLength: 95
                    }
                },
                interaction: {
                    dragNodes: true,
                    dragView: true,
                    zoomView: true,
                    hover: true
                },
                nodes: {
                    shape: 'box',
                    margin: 10,
                    widthConstraint: {
                        maximum: 150
                    }
                },
                edges: {
                    smooth: true
                }
            };

            network = new vis.Network(container, data, options);

            // Обработчики событий
            network.on("click", function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    showNodeInfo(nodeId);
                } else {
                    document.getElementById('node-info').innerHTML = 'Выберите элемент на диаграмме';
                }
            });

            network.on("doubleClick", function(params) {
                if (params.nodes.length > 0) {
                    network.focus(params.nodes[0], { scale: 1.2, animation: true });
                }
            });

            // Заполняем статистику
            updateStatistics();
        }

        function getNodeTooltip(node) {
            let tooltip = `<b>${node.label}</b>`;
            if (node.detailed) tooltip += `\n\n${node.detailed}`;
            if (node.group) tooltip += `\n\nГруппа: ${node.group}`;
            if (node.owner) tooltip += `\nВладелец: ${node.owner}`;
            return tooltip;
        }

        function showNodeInfo(nodeId) {
            const node = diagramData.nodes.find(n => n.id === nodeId);
            if (!node) return;

            let info = `<b>${node.label}</b>`;
            if (node.detailed) info += `<br><br>${node.detailed}`;
            if (node.group) info += `<br><br><b>Группа:</b> ${node.group}`;
            if (node.owner) info += `<br><b>Владелец:</b> ${node.owner}`;
            if (node.type) info += `<br><b>Тип:</b> ${getNodeTypeName(node.type)}`;

            // Находим связанные элементы
            const incoming = diagramData.edges.filter(e => e.to === nodeId);
            const outgoing = diagramData.edges.filter(e => e.from === nodeId);

            if (incoming.length > 0) {
                info += `<br><br><b>Входящие связи (${incoming.length}):</b>`;
                incoming.forEach(edge => {
                    const sourceNode = diagramData.nodes.find(n => n.id === edge.from);
                    const sourceLabel = sourceNode ? sourceNode.label : edge.from;
                    info += `<br>• ${sourceLabel} → ${edge.label}`;
                });
            }

            if (outgoing.length > 0) {
                info += `<br><br><b>Исходящие связи (${outgoing.length}):</b>`;
                outgoing.forEach(edge => {
                    const targetNode = diagramData.nodes.find(n => n.id === edge.to);
                    const targetLabel = targetNode ? targetNode.label : edge.to;
                    info += `<br>• ${edge.label} → ${targetLabel}`;
                });
            }

            document.getElementById('node-info').innerHTML = info;
        }

        function getNodeTypeName(type) {
            const names = {
                external: 'Внешний вход',
                final: 'Конечный выход',
                critical: 'Супер-критическая операция',
                merge: 'Точка слияния',
                split: 'Точка разветвления',
                merge_split: 'Слияние и разветвление',
                normal: 'Обычная операция'
            };
            return names[type] || type;
        }

        function updateStatistics() {
            document.getElementById('stats-operations').textContent = diagramData.statistics.operations_count;
            document.getElementById('stats-inputs').textContent = diagramData.statistics.external_inputs;
            document.getElementById('stats-outputs').textContent = diagramData.statistics.final_outputs;
            document.getElementById('stats-merge').textContent = diagramData.statistics.merge_points;
            document.getElementById('stats-split').textContent = diagramData.statistics.split_points;
            document.getElementById('stats-critical').textContent = diagramData.statistics.critical_points;

            // Заполняем список критических операций
            const criticalList = document.getElementById('critical-list');
            if (diagramData.critical_operations.length > 0) {
                let html = '';
                diagramData.critical_operations.forEach(op => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: #ffeaa7; border-radius: 3px;">
                        <b>${op.operation}</b><br>
                        Входов: ${op.inputs_count}, Использований выхода: ${op.output_reuse}
                    </div>`;
                });
                criticalList.innerHTML = html;
            } else {
                criticalList.innerHTML = '<div style="color: #666;">Критических операций нет</div>';
            }
        }

        function fitToScreen() {
            if (network) {
                network.fit({ animation: true });
            }
        }

        function resetZoom() {
            if (network) {
                network.moveTo({ scale: 1, animation: true });
            }
        }

        function togglePhysics() {
            physicsEnabled = !physicsEnabled;
            if (network) {
                network.setOptions({ physics: { enabled: physicsEnabled } });
            }
            const button = event.target;
            button.textContent = 'Физика: ' + (physicsEnabled ? 'Вкл' : 'Выкл');
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', initNetwork);
    </script>
</body>
</html>